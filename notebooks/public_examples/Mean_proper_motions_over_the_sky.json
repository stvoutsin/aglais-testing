{
  "paragraphs": [
    {
      "title": "Set HEALPix resolution",
      "text": "%pyspark\n\n# set the required HEALPixelisation level here:\nhealpix_level = 6\n# HEALPix level : no. of pixels\n# 4 : 3072\n# 5 : 12288\n# 6 : 49152 ~ 1 square degree pixels\n# 7 : 196608\n",
      "user": "gaiauser",
      "dateUpdated": "2021-10-13T10:28:23+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "editorHide": false,
        "title": true,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1634120903532_1373264302",
      "id": "20210510-111756_391695716",
      "dateCreated": "2021-10-13T10:28:23+0000",
      "status": "READY",
      "focus": true,
      "$$hashKey": "object:4740"
    },
    {
      "title": "Define a data frame by SQL query",
      "text": "%pyspark\nimport math\n\n# compute relevant pixelisation quantities\nnside = int(math.pow(2, healpix_level))\npowers_of_2 = 35 + (12 - healpix_level)*2\ndivisor = int(math.pow(2, powers_of_2))\n\n# formulate SQL query\nquery = \"SELECT floor(source_id /  %d\"%(divisor) + \") AS hpx_id, COUNT(*) AS n, AVG(pmra) AS avg_pmra, AVG(pmdec) AS avg_pmdec FROM gaia_source GROUP BY hpx_id\"\n\n# define a data frame aggregation of the relevant quantities (note this is cached for use in two subsequent cells)\ndf = spark.sql(query).cache()\n",
      "user": "gaiauser",
      "dateUpdated": "2021-10-13T10:28:23+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "editorHide": false,
        "title": true,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1634120903532_377759632",
      "id": "20210510-111538_106023214",
      "dateCreated": "2021-10-13T10:28:23+0000",
      "status": "READY",
      "$$hashKey": "object:4741"
    },
    {
      "title": "Mean RA proper motion plot",
      "text": "%pyspark\n\n# plot up the sky counts\nimport matplotlib.pyplot as plot\nimport numpy as np\nimport healpy as hp\n\n# set a figure to use along with a plot size (landscape, golden ratio)\nplot.figure(1, figsize = (16.18, 10.0))\n\n# healpy constants appropriate to the HEALPix indexing encoded in Gaia source IDs\nnpix = hp.nside2npix(nside)\n\n# do the visualisation\narray_data = np.empty(npix)\nfor item in df.rdd.collect():  array_data[item[0]] = item[2]\nhp.mollview(array_data, fig = 1, coord='C', unit='mas/yr', nest=True, title='Mean RA proper motion at HEALPix level %d'%(healpix_level), cmap='rainbow')\nhp.graticule(coord='C', color='white')",
      "user": "gaiauser",
      "dateUpdated": "2021-10-13T10:28:23+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "editorHide": false,
        "title": true,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1634120903532_1753625322",
      "id": "20210510-111939_1386609632",
      "dateCreated": "2021-10-13T10:28:23+0000",
      "status": "READY",
      "$$hashKey": "object:4742"
    },
    {
      "title": "Mean Dec proper motion plot",
      "text": "%pyspark\n\nplot.figure(2, figsize = (16.18, 10.0))\n\narray_data = np.empty(npix)\nfor item in df.rdd.collect():  array_data[item[0]] = item[3]\nhp.mollview(array_data, fig=2, coord='C', unit='mas/yr', nest=True, title='Mean Dec proper motion at HEALPix level %d'%(healpix_level), cmap='rainbow')\nhp.graticule(coord='C', color='white')\n",
      "user": "gaiauser",
      "dateUpdated": "2021-10-13T10:28:23+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "python",
          "editOnDblClick": false,
          "completionKey": "TAB",
          "completionSupport": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/python",
        "fontSize": 9,
        "editorHide": true,
        "title": true,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1634120903535_2005935728",
      "id": "20210510-111943_814907111",
      "dateCreated": "2021-10-13T10:28:23+0000",
      "status": "READY",
      "$$hashKey": "object:4743"
    },
    {
      "title": "Further reading and resources",
      "text": "%md\n\n* [Gaia source ID definition (for HEALPix indexing)](https://dms.cosmos.esa.int/COSMOS/doc_fetch.php?id=2779219)\n* [Python package healpy](https://healpy.readthedocs.io/en/latest/index.html)\n* [Python matplotlib plotting library](https://matplotlib.org)\n* [Handy HEALPixel characteristics for various levels](https://lambda.gsfc.nasa.gov/toolbox/tb_pixelcoords.cfm)\n\n",
      "user": "gaiauser",
      "dateUpdated": "2021-10-13T10:28:23+0000",
      "progress": 0,
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true,
          "completionKey": "TAB",
          "completionSupport": false
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "fontSize": 9,
        "editorHide": true,
        "title": true,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1634120903539_588186510",
      "id": "20210510-111956_1822284967",
      "dateCreated": "2021-10-13T10:28:23+0000",
      "status": "READY",
      "$$hashKey": "object:4744"
    },
    {
      "text": "%md\n",
      "user": "gaiauser",
      "dateUpdated": "2021-10-13T10:28:23+0000",
      "progress": 0,
      "config": {
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true,
          "completionKey": "TAB",
          "completionSupport": false
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "fontSize": 9,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "runtimeInfos": {},
      "progressUpdateIntervalMs": 500,
      "jobName": "paragraph_1634120903539_1717744302",
      "id": "20210510-132447_1514402898",
      "dateCreated": "2021-10-13T10:28:23+0000",
      "status": "READY",
      "$$hashKey": "object:4745"
    }
  ],
  "name": "Mean proper motions over the sky",
  "id": "2GJD8J584",
  "defaultInterpreterGroup": "spark",
  "version": "0.10.0",
  "noteParams": {},
  "noteForms": {},
  "angularObjects": {},
  "config": {
    "isZeppelinNotebookCronEnable": false,
    "looknfeel": "default",
    "personalizedMode": "false"
  },
  "info": {},
  "path": "/AglaisPublicExamples/Mean proper motions over the sky"
}
