{"paragraphs":[{"text":"%spark.pyspark\ngs_df = sqlContext.read.parquet(\"/data/gaia/*.parquet\")\n\n# following https://spark.apache.org/docs/latest/sql-data-sources-parquet.html\ngs_df.createOrReplaceTempView(\"gaia_source\")\nsql_df = spark.sql(\"SELECT floor(source_id / 562949953421312) AS hpx5, COUNT(*) AS n, AVG(pmra) AS avgPmRa, AVG(pmdec) AS avgPmDec FROM gaia_source GROUP BY hpx5\")\nprint (sql_df.take(10))\n\n\n\n","user":"admin","dateUpdated":"2020-12-07T16:47:50+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1597413887717_1376012402","id":"20200814-140447_461727162","dateCreated":"2020-08-14T14:04:47+0000","dateStarted":"2020-12-07T16:47:50+0000","dateFinished":"2020-12-07T16:51:00+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:13169"},{"text":"%spark.pyspark\n\n# plot up the sky counts\n#import matplotlib.pyplot as plt\nimport numpy as np\nimport healpy as hp\n\n# healpy constants\nNSIDE = 32\nNPIX = hp.nside2npix(NSIDE)\n\n# do the visualisation\narray_data = np.empty(NPIX)\nfor item in sql_df.rdd.collect():  array_data[item[0]] = item[2]\n#array_data = np.array(sql_df.select('hpx5', 'avgPmRa').collect()) ... or somesuch more efficient (elegant, pythonic, vectorized) way of creating the required input for HEALPy?!\nhp.mollview(array_data, nest=True, title='Mean RA proper motion at HEALPix level 5', cmap='rainbow')\nhp.graticule(coord='E', color='white')\n","user":"gaiauser","dateUpdated":"2020-08-20T09:17:58+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1597415011436_-254016456","id":"20200814-142331_657667016","dateCreated":"2020-08-14T14:23:31+0000","dateStarted":"2020-08-20T09:09:12+0000","dateFinished":"2020-08-20T09:10:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13170"},{"text":"%spark.pyspark\n\narray_data = np.empty(NPIX)\nfor item in sql_df.rdd.collect():  array_data[item[0]] = item[3]\nhp.mollview(array_data, nest=True, title='Mean Dec proper motion at HEALPix level 5', cmap='rainbow')\nhp.graticule(coord='E', color='white')\n\n","user":"gaiauser","dateUpdated":"2020-08-20T09:12:14+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1597914722443_-1537708837","id":"20200820-091202_1654912098","dateCreated":"2020-08-20T09:12:02+0000","dateStarted":"2020-08-20T09:12:14+0000","dateFinished":"2020-08-20T09:12:15+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:13171"}],"name":"Mean proper motions over the sky","id":"2FF2VTAAM","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"python:shared_process":[],"angular:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}